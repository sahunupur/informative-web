<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>USA Setup Hub ‚Äî Checklist + Best Links in One Place</title>
  <meta name="description" content="A newcomer-friendly setup hub: checklists + curated official links for SSN, DMV, banking, credit, phone, housing, healthcare, taxes, jobs." />
  <style>
    :root{
      --bg:#0b1020;
      --panel:#101a33;
      --panel2:#0e1630;
      --text:#eef2ff;
      --muted:#b9c3ff;
      --line:rgba(185,195,255,.14);
      --line2:rgba(185,195,255,.22);
      --accent:#7aa2ff;
      --accent2:#9d7bff;
      --good:#2de38a;
      --warn:#ffd166;
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius:18px;
      --radius2:14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --font: system-ui,-apple-system,Segoe UI,Roboto,Arial;
    }

    /* Light theme */
    [data-theme="light"]{
      --bg:#f6f7ff;
      --panel:#ffffff;
      --panel2:#ffffff;
      --text:#0b1020;
      --muted:#3b4261;
      --line:rgba(11,16,32,.10);
      --line2:rgba(11,16,32,.16);
      --accent:#2f6bff;
      --accent2:#7a35ff;
      --shadow: 0 18px 50px rgba(20,30,70,.12);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      background:
        radial-gradient(1100px 520px at 18% -8%, rgba(122,162,255,.22), transparent 60%),
        radial-gradient(900px 420px at 90% 0%, rgba(157,123,255,.18), transparent 55%),
        radial-gradient(900px 520px at 55% 110%, rgba(45,227,138,.10), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}

    .wrap{
      max-width:1180px;
      margin:0 auto;
      padding:18px 16px 48px;
    }

    /* Top bar */
    .topbar{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      padding:14px 14px;
      border:1px solid var(--line);
      border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      position:sticky;
      top:12px;
      z-index:50;
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; gap:12px; align-items:center; min-width:200px;
    }
    .logo{
      width:42px; height:42px; border-radius:14px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      display:grid; place-items:center; font-weight:800;
      color:white; letter-spacing:.5px;
    }
    .brand h1{margin:0; font-size:16px; line-height:1.1}
    .brand .tagline{margin:2px 0 0; font-size:12px; color:var(--muted)}
    .search{
      flex:1;
      display:flex; gap:10px;
      max-width:640px;
      align-items:center;
    }
    input[type="search"]{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line2);
      background: rgba(16,26,51,.35);
      color:var(--text);
      outline:none;
    }
    [data-theme="light"] input[type="search"]{ background:#f2f4ff; }
    .btn{
      cursor:pointer;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--line2);
      background: rgba(16,26,51,.35);
      color:var(--text);
      display:inline-flex;
      gap:8px;
      align-items:center;
      font-weight:600;
      white-space:nowrap;
    }
    [data-theme="light"] .btn{ background:#f2f4ff; }
    .btn:hover{ border-color: rgba(122,162,255,.55); }
    .btn.primary{
      border-color: rgba(122,162,255,.6);
      background: linear-gradient(135deg, rgba(122,162,255,.25), rgba(157,123,255,.20));
    }
    .btn.small{ padding:8px 10px; border-radius:12px; font-size:12px; font-weight:600; }
    .btn.ghost{ background:transparent; }

    /* Layout */
    .layout{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 980px){
      .layout{ grid-template-columns: 1fr; }
      .topbar{ position:relative; top:auto; }
    }

    /* Sidebar */
    .side{
      border:1px solid var(--line);
      border-radius:var(--radius);
      background: rgba(16,26,51,.18);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    [data-theme="light"] .side{ background: rgba(255,255,255,.75); }
    .sideHeader{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    .sideHeader h2{margin:0; font-size:14px}
    .sideHeader p{margin:2px 0 0; font-size:12px; color:var(--muted)}
    .sideBody{ padding:12px 12px 14px; }
    .chips{ display:flex; flex-wrap:wrap; gap:8px; }
    .chip{
      cursor:pointer;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line2);
      background: rgba(16,26,51,.25);
      font-size:12px;
      color:var(--text);
      user-select:none;
    }
    [data-theme="light"] .chip{ background:#f2f4ff; }
    .chip.active{
      border-color: rgba(122,162,255,.7);
      box-shadow: 0 0 0 3px rgba(122,162,255,.15) inset;
    }

    /* Progress card */
    .progressCard{
      margin-top:12px;
      border:1px solid var(--line);
      border-radius:var(--radius);
      background: rgba(16,26,51,.22);
      padding:14px;
    }
    [data-theme="light"] .progressCard{ background: rgba(242,244,255,.85); }
    .progressTop{
      display:flex; gap:12px; align-items:center;
    }
    .ring{
      width:54px; height:54px;
      border-radius:50%;
      display:grid; place-items:center;
      background:
        conic-gradient(var(--good) var(--deg), rgba(185,195,255,.18) 0);
      position:relative;
      flex:0 0 auto;
    }
    .ring::after{
      content:"";
      width:42px; height:42px;
      border-radius:50%;
      background: var(--panel);
      position:absolute;
      border:1px solid var(--line);
    }
    .ring span{
      position:relative; z-index:2;
      font-family:var(--mono);
      font-size:12px;
      color:var(--text);
    }
    [data-theme="light"] .ring::after{ background:#fff; }
    .progressText h3{margin:0; font-size:13px}
    .progressText p{margin:2px 0 0; font-size:12px; color:var(--muted)}
    .sideActions{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }

    /* Content */
    .content{
      border-radius:var(--radius);
    }

    .hero{
      border:1px solid var(--line);
      border-radius:var(--radius);
      background: linear-gradient(135deg, rgba(122,162,255,.18), rgba(157,123,255,.12));
      box-shadow: var(--shadow);
      padding:16px;
    }
    [data-theme="light"] .hero{
      background: linear-gradient(135deg, rgba(47,107,255,.12), rgba(122,53,255,.10));
    }
    .hero h2{margin:0; font-size:18px}
    .hero p{margin:8px 0 0; color:var(--muted); line-height:1.45}
    .heroRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }

    .cards{
      margin-top:14px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
    }

    .card{
      grid-column: span 6;
      border:1px solid var(--line);
      border-radius:var(--radius);
      background: rgba(16,26,51,.18);
      box-shadow: var(--shadow);
      padding:14px;
      overflow:hidden;
      position:relative;
    }
    [data-theme="light"] .card{ background: rgba(255,255,255,.75); }
    @media (max-width: 980px){ .card{ grid-column: span 12; } }

    .cardHead{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .cardHead h3{margin:0; font-size:15px; line-height:1.25}
    .meta{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px;
    }
    .pill{
      font-size:12px;
      padding:5px 9px;
      border-radius:999px;
      border:1px solid var(--line2);
      background: rgba(16,26,51,.25);
      color:var(--text);
    }
    [data-theme="light"] .pill{ background:#f2f4ff; }
    .prio{ font-weight:800; font-family:var(--mono); }
    .p1{ border-color: rgba(45,227,138,.45); }
    .p2{ border-color: rgba(255,209,102,.50); }
    .p3{ border-color: rgba(255,92,122,.45); }

    .desc{
      margin:10px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
    }

    .checklist{
      margin-top:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .task{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 10px;
      border-radius:var(--radius2);
      border:1px dashed var(--line2);
      background: rgba(0,0,0,.08);
    }
    [data-theme="light"] .task{ background: rgba(47,107,255,.06); }
    .task input{ margin-top:2px; }
    .task .tTitle{ font-weight:700; font-size:13px; }
    .task .tSub{ margin-top:2px; font-size:12px; color:var(--muted); }

    .links{
      margin-top:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .link{
      display:flex; gap:10px; justify-content:space-between; align-items:center;
      padding:10px;
      border-radius:var(--radius2);
      border:1px solid var(--line);
      background: rgba(16,26,51,.18);
    }
    [data-theme="light"] .link{ background:#fff; }
    .linkLeft{ display:flex; flex-direction:column; gap:2px; min-width:0; }
    .linkLeft a{ font-weight:700; font-size:13px; }
    .url{
      font-family:var(--mono);
      font-size:11px;
      color:var(--muted);
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width:520px;
    }
    @media (max-width: 980px){ .url{ max-width: 260px; } }

    .empty{
      grid-column: span 12;
      padding:22px;
      border-radius:var(--radius);
      border:1px dashed var(--line2);
      background: rgba(16,26,51,.12);
      color:var(--muted);
      text-align:center;
    }

    /* Saved drawer */
    .drawer{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.45);
      display:none;
      z-index:100;
      padding:18px;
    }
    .drawer.open{ display:block; }
    .drawerPanel{
      max-width:820px;
      margin:0 auto;
      height:calc(100vh - 36px);
      border-radius:var(--radius);
      background: var(--panel);
      border:1px solid var(--line);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    [data-theme="light"] .drawerPanel{ background:#fff; }
    .drawerHead{
      padding:14px;
      border-bottom:1px solid var(--line);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
    }
    .drawerHead h3{ margin:0; font-size:14px; }
    .drawerBody{ padding:14px; overflow:auto; }
    .savedList{ display:flex; flex-direction:column; gap:10px; }
    .savedItem{
      border:1px solid var(--line);
      border-radius:var(--radius2);
      padding:12px;
      background: rgba(16,26,51,.10);
    }
    [data-theme="light"] .savedItem{ background:#f7f8ff; }
    .savedItem .top{
      display:flex; justify-content:space-between; gap:10px; align-items:center;
    }
    .savedItem .top a{ font-weight:800; }
    .savedItem .bottom{ margin-top:6px; font-family:var(--mono); font-size:11px; color:var(--muted); word-break:break-all; }

  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo">US</div>
        <div>
          <h1>USA Setup Hub</h1>
          <div class="tagline">One page. Checklists + best links. Save progress.</div>
        </div>
      </div>

      <div class="search">
        <input id="q" type="search" placeholder="Search: SSN, DMV, credit, utilities, taxes..." />
        <button class="btn" id="toggleTheme" title="Toggle theme">üåô</button>
        <button class="btn primary" id="openSaved" title="View saved links">‚òÖ Saved</button>
      </div>
    </div>

    <div class="layout">
      <aside class="side">
        <div class="sideHeader">
          <div>
            <h2>Categories</h2>
            <p>Filter the hub fast</p>
          </div>
          <button class="btn small" id="resetAll" title="Reset progress & saved">Reset</button>
        </div>

        <div class="sideBody">
          <div class="chips" id="filters"></div>

          <div class="progressCard">
            <div class="progressTop">
              <div class="ring" id="ring" style="--deg:0deg"><span id="ringTxt">0%</span></div>
              <div class="progressText">
                <h3 id="progressTitle">Progress</h3>
                <p id="progressSub">0/0 tasks done</p>
              </div>
            </div>
            <div class="sideActions">
              <button class="btn small" id="copyPage">Copy page link</button>
              <button class="btn small ghost" id="expandAll">Expand all</button>
              <button class="btn small ghost" id="collapseAll">Collapse all</button>
            </div>
          </div>

          <div style="margin-top:12px; font-size:12px; color:var(--muted); line-height:1.45">
            <b>Tip:</b> Add a ‚ÄúContribute a link‚Äù button later (Google Form) to grow the hub organically.
          </div>
        </div>
      </aside>

      <section class="content">
        <div class="hero">
          <h2>Everything you wish someone gave you on Day 1</h2>
          <p>
            This hub is intentionally organized by the things people search repeatedly: official links first, plus simple checklists.
            Your progress + saved links stay on your device (local storage).
          </p>
          <div class="heroRow">
            <button class="btn small primary" id="shareTop">Share this hub</button>
            <button class="btn small" id="showP1">Show only P1</button>
            <button class="btn small" id="showAll">Show all</button>
          </div>
        </div>

        <div class="cards" id="cards"></div>
      </section>
    </div>
  </div>

  <!-- Saved links drawer -->
  <div class="drawer" id="drawer">
    <div class="drawerPanel">
      <div class="drawerHead">
        <h3>‚òÖ Saved Links</h3>
        <div style="display:flex; gap:10px; align-items:center;">
          <button class="btn small" id="copySaved">Copy all</button>
          <button class="btn small" id="closeSaved">Close</button>
        </div>
      </div>
      <div class="drawerBody">
        <div class="savedList" id="savedList"></div>
      </div>
    </div>
  </div>

<script>
  // -------- Data (edit to customize) --------
  const CATEGORIES = ["All","SSN","DMV","Banking","Credit","Phone & Internet","Housing & Utilities","Healthcare","Taxes","Jobs & Docs"];

  const DATA = [
    {
      id:"ssn",
      title:"Get your SSN (Social Security Number)",
      category:"SSN",
      priority:"P1",
      summary:"Your SSN is used for work, banking, credit, taxes, and many verifications.",
      tasks:[
        "Apply (if eligible) after you have your entry/immigration docs ready.",
        "Find nearest SSA office + required documents.",
        "Use a stable mailing address; track delivery."
      ],
      links:[
        {label:"SSA ‚Äî Social Security Administration", url:"https://www.ssa.gov/"},
        {label:"SSA Office Locator", url:"https://secure.ssa.gov/ICON/main.jsp"}
      ]
    },
    {
      id:"dmv",
      title:"Driver‚Äôs license / State ID / Car registration",
      category:"DMV",
      priority:"P1",
      summary:"DMV rules vary by state. This is usually the most confusing step for newcomers.",
      tasks:[
        "Check your state DMV/MVD document list + appointment availability.",
        "Prepare for written/road tests if required.",
        "If you own a car: registration + insurance (+ emissions if state requires)."
      ],
      links:[
        {label:"DMV.org ‚Äî Find your state DMV", url:"https://www.dmv.org/"}
      ]
    },
    {
      id:"bank",
      title:"Open a bank account + set up direct deposit",
      category:"Banking",
      priority:"P1",
      summary:"Choose a low-fee account and turn on alerts to avoid surprises.",
      tasks:[
        "Pick checking account with no monthly fee (or easy waiver).",
        "Confirm acceptable documents (passport, visa/I-94, proof of address).",
        "Enable online banking + alerts + Zelle (if available)."
      ],
      links:[
        {label:"FDIC ‚Äî Banking basics", url:"https://www.fdic.gov/"},
        {label:"CFPB ‚Äî Consumer finance tools", url:"https://www.consumerfinance.gov/"}
      ]
    },
    {
      id:"credit",
      title:"Build credit (fast, safely)",
      category:"Credit",
      priority:"P1",
      summary:"Autopay + low utilization + correct reports = strong foundation.",
      tasks:[
        "Get a starter credit card (secured if needed).",
        "Set autopay: full statement balance.",
        "Check official free credit reports; dispute errors."
      ],
      links:[
        {label:"AnnualCreditReport.com (official)", url:"https://www.annualcreditreport.com/"},
        {label:"CFPB ‚Äî Credit scores & reports", url:"https://www.consumerfinance.gov/consumer-tools/credit-reports-and-scores/"}
      ]
    },
    {
      id:"phone",
      title:"Phone plan that fits (don‚Äôt overpay)",
      category:"Phone & Internet",
      priority:"P2",
      summary:"Prepaid vs postpaid, coverage near home/work, and international calling add-ons.",
      tasks:[
        "Decide prepaid vs postpaid; check coverage near home/work.",
        "If calling abroad: compare international add-ons (only one line needs it).",
        "Enable Wi-Fi calling; consider eSIM if supported."
      ],
      links:[
        {label:"FCC ‚Äî Consumer telecom info", url:"https://www.fcc.gov/consumers"}
      ]
    },
    {
      id:"housing",
      title:"Housing setup: utilities + renter‚Äôs insurance + address change",
      category:"Housing & Utilities",
      priority:"P1",
      summary:"Set start dates early. Keep proof of address screenshots handy.",
      tasks:[
        "Schedule electricity/water/internet activation before move-in.",
        "Get renter‚Äôs insurance (often $10‚Äì$25/mo).",
        "Submit USPS change-of-address and update key accounts."
      ],
      links:[
        {label:"USPS ‚Äî Change of Address", url:"https://moversguide.usps.com/"},
        {label:"NAIC ‚Äî Renters insurance basics", url:"https://content.naic.org/consumer"}
      ]
    },
    {
      id:"health",
      title:"Healthcare basics: urgent care vs ER + insurance vocabulary",
      category:"Healthcare",
      priority:"P2",
      summary:"Knowing the right place to go can save you hundreds or thousands.",
      tasks:[
        "Learn: premium, deductible, copay, coinsurance, out-of-pocket max.",
        "Find a primary care doctor and an in-network urgent care nearby.",
        "Save insurance ID card + member portal login."
      ],
      links:[
        {label:"Healthcare.gov ‚Äî Glossary", url:"https://www.healthcare.gov/glossary/"},
        {label:"MedlinePlus ‚Äî General health info", url:"https://medlineplus.gov/"}
      ]
    },
    {
      id:"tax",
      title:"Tax basics: W-2 vs 1099 + IRS account",
      category:"Taxes",
      priority:"P2",
      summary:"Create your IRS account and keep docs organized from day one.",
      tasks:[
        "Create an IRS online account.",
        "Know your form type (W-2 employee vs 1099 contractor).",
        "Keep paystubs + key documents for filing."
      ],
      links:[
        {label:"IRS ‚Äî Home", url:"https://www.irs.gov/"},
        {label:"IRS ‚Äî Your online account", url:"https://www.irs.gov/payments/your-online-account"}
      ]
    },
    {
      id:"jobs",
      title:"Job docs checklist (what to keep)",
      category:"Jobs & Docs",
      priority:"P2",
      summary:"Keep copies of everything: offer letter, I-9 docs, benefits, pay stubs.",
      tasks:[
        "Save: offer letter, I-9 docs, pay stubs, benefits enrollment PDFs.",
        "Understand 401(k), HSA/FSA if offered.",
        "Set up payroll portal + W-4 withholding."
      ],
      links:[
        {label:"USCIS ‚Äî Form I-9 info", url:"https://www.uscis.gov/i-9"},
        {label:"IRS ‚Äî Form W-4 info", url:"https://www.irs.gov/forms-pubs/about-form-w-4"}
      ]
    }
  ];

  // -------- Persistence --------
  const LS = {
    theme: "usahub_theme_v2",
    checked: "usahub_checked_v2",
    favs: "usahub_favs_v2",
    collapsed: "usahub_collapsed_v2",
    get(key, fallback){ try { return JSON.parse(localStorage.getItem(key)) ?? fallback; } catch { return fallback; } },
    set(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
  };

  let activeCategory = "All";
  let onlyP1 = false;

  let checked = LS.get(LS.checked, {});
  let favs = new Set(LS.get(LS.favs, []));
  let collapsed = LS.get(LS.collapsed, {}); // {cardId: boolean}

  // -------- Elements --------
  const filtersEl = document.getElementById("filters");
  const cardsEl = document.getElementById("cards");
  const qEl = document.getElementById("q");

  const ringEl = document.getElementById("ring");
  const ringTxt = document.getElementById("ringTxt");
  const progressTitle = document.getElementById("progressTitle");
  const progressSub = document.getElementById("progressSub");

  const toggleThemeBtn = document.getElementById("toggleTheme");
  const openSavedBtn = document.getElementById("openSaved");

  const drawer = document.getElementById("drawer");
  const savedList = document.getElementById("savedList");

  // -------- Theme --------
  function applyTheme(theme){
    document.documentElement.setAttribute("data-theme", theme);
    toggleThemeBtn.textContent = theme === "light" ? "üåû" : "üåô";
    LS.set(LS.theme, theme);
  }
  applyTheme(LS.get(LS.theme, "dark"));

  toggleThemeBtn.onclick = ()=>{
    const cur = document.documentElement.getAttribute("data-theme") || "dark";
    applyTheme(cur === "dark" ? "light" : "dark");
  };

  // -------- Helpers --------
  function prioClass(p){ return p==="P1" ? "p1" : (p==="P2" ? "p2" : "p3"); }

  function matches(item, q){
    if(!q) return true;
    const hay = (item.title + " " + item.category + " " + item.summary + " " + item.tasks.join(" ") + " " + item.links.map(l=>l.label).join(" "))
      .toLowerCase();
    return hay.includes(q.toLowerCase());
  }

  async function copyText(text){
    try { await navigator.clipboard.writeText(text); alert("Copied!"); }
    catch { prompt("Copy:", text); }
  }

  function toggleCheck(itemId, idx){
    const key = itemId + ":" + idx;
    checked[key] = !checked[key];
    LS.set(LS.checked, checked);
    render();
  }

  function toggleFav(url){
    if(favs.has(url)) favs.delete(url); else favs.add(url);
    LS.set(LS.favs, Array.from(favs));
    render();
  }

  function toggleCollapse(itemId){
    collapsed[itemId] = !collapsed[itemId];
    LS.set(LS.collapsed, collapsed);
    render();
  }

  function computeProgress(items){
    const total = items.reduce((a,it)=>a+it.tasks.length,0);
    const done = items.reduce((a,it)=>a+it.tasks.filter((_,i)=>checked[it.id+":"+i]).length,0);
    const pct = total ? Math.round((done/total)*100) : 0;
    return {total, done, pct};
  }

  // -------- Filters --------
  function renderFilters(){
    filtersEl.innerHTML = "";
    CATEGORIES.forEach(cat=>{
      const el = document.createElement("div");
      el.className = "chip" + (cat===activeCategory ? " active" : "");
      el.textContent = cat;
      el.onclick = ()=>{ activeCategory = cat; renderFilters(); render(); };
      filtersEl.appendChild(el);
    });
  }

  // -------- Cards --------
  function render(){
    const q = qEl.value.trim();

    let items = DATA
      .filter(it => activeCategory==="All" ? true : it.category===activeCategory)
      .filter(it => onlyP1 ? it.priority==="P1" : true)
      .filter(it => matches(it, q));

    const {total, done, pct} = computeProgress(items);

    // progress ring
    ringEl.style.setProperty("--deg", (pct*3.6) + "deg");
    ringTxt.textContent = pct + "%";
    progressTitle.textContent = "Progress";
    progressSub.textContent = `${done}/${total} tasks done`;

    cardsEl.innerHTML = "";

    items.forEach(item=>{
      const card = document.createElement("div");
      card.className = "card";
      card.id = "sec-" + item.id;

      const isCollapsed = !!collapsed[item.id];

      const head = document.createElement("div");
      head.className = "cardHead";
      head.innerHTML = `
        <div style="min-width:0">
          <h3>${item.title}</h3>
          <div class="meta">
            <span class="pill">${item.category}</span>
            <span class="pill prio ${prioClass(item.priority)}">${item.priority}</span>
            <span class="pill" style="opacity:.9">Official links first</span>
          </div>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;">
          <button class="btn small" data-act="share">Share</button>
          <button class="btn small" data-act="collapse">${isCollapsed ? "Expand" : "Collapse"}</button>
        </div>
      `;

      head.querySelector('[data-act="share"]').onclick = ()=>{
        const link = location.origin + location.pathname + "#sec-" + item.id;
        copyText(link);
      };
      head.querySelector('[data-act="collapse"]').onclick = ()=>toggleCollapse(item.id);

      const desc = document.createElement("div");
      desc.className = "desc";
      desc.textContent = item.summary;

      const body = document.createElement("div");
      body.style.display = isCollapsed ? "none" : "block";

      // tasks
      const checklist = document.createElement("div");
      checklist.className = "checklist";
      item.tasks.forEach((t, idx)=>{
        const key = item.id + ":" + idx;
        const row = document.createElement("label");
        row.className = "task";
        row.innerHTML = `
          <input type="checkbox" ${checked[key] ? "checked" : ""} />
          <div>
            <div class="tTitle">${t}</div>
            <div class="tSub">Tick to save (stored on this device).</div>
          </div>
        `;
        row.querySelector("input").onchange = ()=>toggleCheck(item.id, idx);
        checklist.appendChild(row);
      });

      // links
      const links = document.createElement("div");
      links.className = "links";
      item.links.forEach(l=>{
        const saved = favs.has(l.url);
        const row = document.createElement("div");
        row.className = "link";
        row.innerHTML = `
          <div class="linkLeft">
            <a href="${l.url}" target="_blank" rel="noopener">${l.label}</a>
            <div class="url">${l.url}</div>
          </div>
          <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;">
            <button class="btn small" data-act="save">${saved ? "‚òÖ Saved" : "‚òÜ Save"}</button>
            <button class="btn small" data-act="copy">Copy</button>
          </div>
        `;
        row.querySelector('[data-act="save"]').onclick = ()=>toggleFav(l.url);
        row.querySelector('[data-act="copy"]').onclick = ()=>copyText(l.url);
        links.appendChild(row);
      });

      body.appendChild(checklist);
      body.appendChild(links);

      card.appendChild(head);
      card.appendChild(desc);
      card.appendChild(body);

      cardsEl.appendChild(card);
    });

    if(items.length === 0){
      const empty = document.createElement("div");
      empty.className = "empty";
      empty.innerHTML = `<b>No results</b><div style="margin-top:6px">Try ‚ÄúSSN‚Äù, ‚ÄúDMV‚Äù, ‚Äúcredit‚Äù, ‚Äúutilities‚Äù, or remove filters.</div>`;
      cardsEl.appendChild(empty);
    }
  }

  // -------- Saved Drawer --------
  function openDrawer(){
    drawer.classList.add("open");
    renderSaved();
  }
  function closeDrawer(){ drawer.classList.remove("open"); }

  function renderSaved(){
    savedList.innerHTML = "";
    const urls = Array.from(favs);
    if(urls.length === 0){
      savedList.innerHTML = `<div class="savedItem"><div class="top"><b>No saved links yet</b></div><div class="bottom">Click ‚òÜ Save on any link to store it here.</div></div>`;
      return;
    }

    urls.forEach(u=>{
      // Try to find label from DATA
      let label = "Saved link";
      for(const it of DATA){
        const found = it.links.find(x=>x.url===u);
        if(found){ label = found.label; break; }
      }
      const item = document.createElement("div");
      item.className = "savedItem";
      item.innerHTML = `
        <div class="top">
          <a href="${u}" target="_blank" rel="noopener">${label}</a>
          <button class="btn small" data-act="remove">Remove</button>
        </div>
        <div class="bottom">${u}</div>
      `;
      item.querySelector('[data-act="remove"]').onclick = ()=>{
        favs.delete(u);
        LS.set(LS.favs, Array.from(favs));
        renderSaved();
        render();
      };
      savedList.appendChild(item);
    });
  }

  // -------- Wire up controls --------
  qEl.addEventListener("input", render);

  document.getElementById("copyPage").onclick = ()=>copyText(location.href.split("#")[0]);
  document.getElementById("shareTop").onclick = ()=>copyText(location.href.split("#")[0]);

  document.getElementById("showP1").onclick = ()=>{ onlyP1 = true; render(); };
  document.getElementById("showAll").onclick = ()=>{ onlyP1 = false; render(); };

  document.getElementById("expandAll").onclick = ()=>{
    DATA.forEach(it=>collapsed[it.id]=false);
    LS.set(LS.collapsed, collapsed);
    render();
  };
  document.getElementById("collapseAll").onclick = ()=>{
    DATA.forEach(it=>collapsed[it.id]=true);
    LS.set(LS.collapsed, collapsed);
    render();
  };

  document.getElementById("resetAll").onclick = ()=>{
    if(confirm("Reset all progress and saved links on this device?")){
      checked = {}; favs = new Set(); collapsed = {};
      LS.set(LS.checked, checked);
      LS.set(LS.favs, Array.from(favs));
      LS.set(LS.collapsed, collapsed);
      render();
    }
  };

  openSavedBtn.onclick = openDrawer;
  document.getElementById("closeSaved").onclick = closeDrawer;
  drawer.addEventListener("click", (e)=>{ if(e.target === drawer) closeDrawer(); });

  document.getElementById("copySaved").onclick = ()=>{
    const text = Array.from(favs).join("\n");
    if(!text) return alert("No saved links yet.");
    copyText(text);
  };

  // Init
  renderFilters();
  render();

  // Smooth jump to hash section
  if(location.hash){
    const el = document.querySelector(location.hash);
    if(el) el.scrollIntoView({behavior:"smooth", block:"start"});
  }
</script>
</body>
</html>
